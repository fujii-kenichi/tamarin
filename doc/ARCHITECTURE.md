# アーキテクチャ

タマリンのアーキテクチャについてのメモです。

## 1. 前提条件

- 全体:オンプレでもクラウドと同じように動く技術スタックを採用したい。
- 全体:できる限り商用での稼働実績があり安定した構成を採用したい。
- クライアント側:PWAという比較的現段階では未成熟な技術を使用しているので、問題が発生した時の切り分けの容易性を確保するためにできるだけフレームワークを使用しないでなるべくシンプルな構成にしておきたい。技術の確認ができたらいまどきのUIフレームワークで機能を拡張していく。
- サーバ側:なるべく簡単に最初のバージョンを開発できる開発容易性と、稼働後における高い拡張性の両立を目指したい。
- クラウド側:可能な限り運用コストを低減できるようにしたい。

## 2. 非機能要求

- PWAを採用することでストアに依存しないアプリケーションのデリバリを実現すること。
- タマリンカメラの実行環境としてiPhone, iPod (Safari)とAndroid (Chrome)をサポートすること。
- タマリンクの実行環境としてWindows 10 Home (Chromium Edge)をサポートすること。

## 3. 導出した構成要素

- サーバサイドのメイン記述言語は拡張性や安定性からPython 3に決定。
- メインデータベースはオンプレ・クラウド双方への適用と実績からPostgreSQLに決定。
- サーバサイドのフレームワークは管理機能の充実や開発生産性の高さからDjango 3に決定。
- サーバサイドのOSはPythonとPostgreSQLからLinuxに決定。
- クライアントサイドは前述の通り当面はできる限りプレインなJavaScriptとHTML/CSSで構成することを決定。そのうち開発が複雑化してきたら適切なUIフレームワークに移行する…と最初はおもっていたけど、途中でさすがに自力でのレスポンシブはつらくなってしまって、CSSだけはBulmaを使用する。
- クラウド環境は本来PWAということではGCPが最適のような気もするが、諸般の事情でAzureに決定。
- クラウドに持っていった際にもっとも課金的な懸念のある写真のストレージは、パフォーマンスとコストを勘案してオブジェクトストレージであるAzureストレージを使用することを決定。
- Djangoアプリケーションの実行環境は、スケーラビリティとコストからApp Serviceを使用することに決定。
- PostgreSQLは機能面からみればAzure PostgreSQLが最適であるが、コスト面ではちょっと高いのでここはあえて最小構成のVMで稼働させることを決定。最終的にはAzure PostgreSQLへの移行を想定。

## 4. 最終的な構成

<https://app.diagrams.net> で書いた図を貼っておきます。

[](./tamarin-overview.drawio.svg)
<img src="./tamarin-overview.drawio.svg">
